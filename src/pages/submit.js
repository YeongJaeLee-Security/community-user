import React, { useState, FormEvent } from "react";
import Head from "next/head";
import Editor from "@/components/editor";

export default function Page() {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);

  async function onSubmit(event) {
    event.preventDefault();
    setIsLoading(true); // Set loading to true when the request starts
    setError(null);

    try {
      const formData = new FormData(event.currentTarget);
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      });

      if (!response.ok) {
        throw new Error("Failed to submit data. Please try again");
      }

      // Handle response if necessary
      const data = await response.json();
      // ...
    } catch (error) {
      // Handle error if necessary
      console.error(error);
    } finally {
      setIsLoading(false); // Set loading to false when the request completes
    }
  }

  return (
    <>
      {error && <div style={{ color: "red "}}>{error}</div>}
      <Head>
        <title>Submit to Community CMS</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Editor
        onSubmit={onSubmit}
        isLoading={isLoading}
      ></Editor>
    </>
  );
}
